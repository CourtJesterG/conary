Fixed performance regression when committing to a very large repository.
